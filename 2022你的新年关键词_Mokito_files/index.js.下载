let wx = false;
let cunzai = false;
let cunzaiImg = false;
let yice = JSON.parse(localStorage.getItem('wujg'))||[];
// 检测当前运行环境
(function isWeChat() {
  //window.navigator.userAgent属性包含了浏览器类型、版本、操作系统类型、浏览器引擎类型等信息，这个属性可以用来判断浏览器类型
  var ua = window.navigator.userAgent.toLowerCase();
  //通过正则表达式匹配ua中是否含有MicroMessenger字符串
  if (ua.match(/MicroMessenger/i) == 'micromessenger') {
    console.log('当前运行环境为微信')
    wx = true;
    return true;
  } else {
    console.log('当前运行环境非微信')
    return false;
  }
})();
const word = [['新生', '你要做一个不动声色的大人了。不准情绪化，不准偷偷想念，不准回头看。去过自己的新生活。', '每一天醒来,都是新生。'],
['慎独', '慎独就是在独处时，对自己的言行也能做到谨慎不苟，不需要任何人监督。', '你也能成为自己的太阳。'],
['改变', '如果你想要和自己喜欢的人在一起，那就让自己能够和她并肩同行。先变成自己喜欢的自己，再遇见一个无须取悦的人。', '改变是痛苦的, 不改变是更加痛苦的！'],
['精进', '能接吻就不要说话，能拥抱就不要吵架，好的东西不要珍藏，今天能做的事不要等到明天。', '含泪播种的人一定能含笑收获。'],
['上岸', '考的全会，蒙的全对，2022成功上岸！你终将站在自己热爱的世界里闪闪发光', '关关难过关关过 前路漫漫而灿灿'],
['打工', '有个问题！首先我因为没有钱选择出来打工，然后因为打工所以没有钱，那么到底是哪个环节出了问题？', '打工人打工魂，打工都是人上人'],
['孤寡', '你住的城市下雨了，想问你有没有带伞，可我不敢。因为我怕你说没带，而我又无能为力，就像是我爱你，却给不了你想要的温暖。', '以前喜欢一个人，现在只能一个人'],
['无效人', '考试大概是个陪跑的', '我忘记了，但我深刻的知道我经常做无效的事。就像这句话，就是无效的，毕竟我做过什么无效的事我也没说清楚。'],
['职物人', '天天想辞职，月月都满勤，加油吧打工人！', '同是天涯职物人'],
['都市土狗', '不再讲究穿得多精致，基本没有穿搭可言，一切以舒适为主，怎么舒服怎么来', '人在城乡结合部，心在巴黎时装周'],
['社牛', '社交牛逼症临床症状：海王式打招呼，见到谁都说亲爱的', '长期以他人的眼光为评判自己的标准，就会陷入自我否定的地狱之中，所以请社牛起来。'],
['相守', '始于初见，止于终老。', '在故事的最后尽头 有我陪着你  直到永久'],
['果敢', '花开堪折直须折，莫待无花空折枝。不是因为看到了才相信，而是因为相信才看得到。', '世上没有绝望的处境，只有对处境犹豫的人。'],
['糊涂', '情深不寿，慧极必伤。生活是一种感觉，不是一道题目，对要学会难得糊涂。', '在大事情上“糊涂”，在小事情上“不糊涂”，人生必定会“多姿多彩”'],
['遇见', '星星发亮是为了让每一个人有一天都能找到属于自己的星星', '我看着路梦的入口有点窄，我遇见你是最美丽的意外'],
['一战成硕','若有恒，何须三更眠五更起；最无益，莫过一日曝十日寒。','人生能有几回博，你我山巅自相逢！'],
['金榜题名','新的一年里，金榜题名已是铁板钉钉，鱼跃龙门也是志在必得。','乾坤未定，你就是黑马'],
['收获','生活不在别处，而在于你想要什么，你付出了多少就会收获多少。','上帝是公平的，你的收获马上到来。'],
['秋实','今天收获的幸福与快乐，是昨日梦想种子所盛开的花。','收获的喜悦气息，带着成熟的光芒马上将出现在你的面前。'],
['耕耘','生活是公平的，虽然不敢说一分耕耘必有一分收获，但现在的忙碌既是对以前虚度光阴的弥补，也是未来生活的铺垫。','莫问收获,但问耕耘'],
['健康','疫去春来，新的一年健健康康身体倍棒。','革命身体最重要,上网不要熬通宵'],
['桃花','身在桃花源，遇见桃花运。','你要交桃花运了，准备好了吗？'],
['多金','五行属金，新的一年必定多金','小孩子才喜欢生气，成年人更喜欢生钱。'],
['暴富','这世界上值得开心的事不止暴富，还有抱抱我。','何以解忧，唯有暴富。'],
['脱单','你听见风来自地铁和人海，TA排着队拿着爱的号码牌。','穿过一路的风景，等你的那个人终会出现'],
['乘风破浪','在这个荆棘遍布的世界或许不会一帆风顺，但你一定可以乘风破浪！','长风破浪会有时，直挂云帆济沧海'],
['披荆斩棘','见过大海也看过繁星，直到登上山顶，才明白披荆斩棘的意义','从今以后，不摧不移，披荆斩棘'],
['旅行','说走就走，是人生最华丽的奢侈，也是最灿烂的自由','身体和灵魂必须有一个在路上'],
['佳境','如果在黑夜里艰难流浪，只要再往前走一小步，接下来就会渐入佳境。','缓缓避莽撞，渐渐入佳境'],
['重逢','期待已久的幸福逆着人流向你走过来，迎着阳光对你说“好久不见”','即使许久未见，再见依旧如初'],
['勇敢','真正的勇敢不是没有恐惧，而是心怀恐惧仍然前行','如果害怕的话就闭上眼走几步，也许睁开眼的时候就是光呢'],
['断舍离','适时给生活做减法，我们才有更多的精力和时间享受生活的美好，追寻更有意义的人生。','清空内心的负累，便能洞见幸福的真谛。'],
['超常发挥','考的都会，蒙的全对，新的一年每次考试都是超常发挥','保持热爱，奔赴下一场山海'],
['学无止境','学无止境，喜欢的就去学吧，你的生活充实了，你还会有时间心烦吗？','如果人一辈子只有一个职业，那必定是学生'],
['知足','当一个人感到很知足，心不烦，身不疲，无所求，心能安的时候，快乐就在其中。','知足常乐的时候，什么事情都不会成为负累'],
['升职','听说你要升职了,恭喜你步步高升,前途无量','抽到此签的人不是领导就是未来的领导'],
['自由','仍然自由自我，永远高唱高歌，走遍千里','原谅我这一生不羁放纵爱自由'],
['永不脱发','头上不脱发、脸上不爆痘、晚上不失眠、卡上不缺钱','请珍惜以这个发型见你的我，因为真的很掉头发，每次都是限量版见面。'],
['躺赚','躺着就能赚钱','当房东和做白日梦都可以让你躺赚'],
['圆梦','牢牢抓住你的梦想，朝着它奋斗，因为幸运之神马上就会降临到你的身边。','圆规为什么能画圆圈，因为脚在走，心不变，想圆梦也一样。'],
['逢考必过','通知：你过了；恭喜：已录用','愿你有勇气也有运气！'],
['狂吃不胖','新年四个愿望：不劳而获，不学有术，相爱无伤，狂吃不胖。各位英雄，对于这几个笑话，你怎么看？','不要看见别人长的胖了点就叫人家…粗人！'],
['远方','生活不止眼前的苟且，还有诗和远方的田野','所有不知道的远方，都是值得一去的天堂。'],
['舍得','舍得舍得，有舍才有得。舍得笑容，得到的是友谊；舍得宽容，得到的是大气。','上帝关上了一扇门，必然会为你打开另一扇窗；你失去了一种东西，必然会在其他地方收获..'],
]
function randomNum(minNum, maxNum) {
  switch (arguments.length) {
    case 1:
      return parseInt(Math.random() * minNum + 1, 10);
      break;
    case 2:
      return parseInt(Math.random() * (maxNum - minNum + 1) + minNum, 10);
      break;
    default:
      return 0;
  }
}
$('.submit').click(function () {
  let name = $('.put-user-name').val()
  console.log(name)
  if (name === '') {
    alert('请先输入有效的名字')
    return
  }
  let num = randomNum(0, word.length-1)
  let xiangmu = yice.filter(item => {
    return item.name === name
  })
  console.log(xiangmu)
  cunzai = xiangmu.length !== 0
  console.log(cunzai)
  if(cunzai) {
    num=xiangmu[0].num
  } else {
    yice.push({ name, num })
    window.localStorage.setItem('gs2022xnq', JSON.stringify(yice))
  }
  $('.user-name')[0].innerText = '@' + name
  $('.main-header-l')[0].innerText = word[num][0]
  $('.jieshi')[0].innerText = word[num][1]
  $('.zongshu')[0].innerText = word[num][2]
  $('.zhezhao').hide(1000)
})

function creatCImg() {
  const body = document.querySelector('.jietu-wrap');
  const wrap = document.querySelector('.wrap');
  function takeScreenshot() {
    html2canvas(body).then((canvas) => {
      const image = new Image();
      const imgUrl = canvas.toDataURL('image/png');
      image.src = imgUrl;
      // console.log(imgUrl);

      if (wx) {
        if (!cunzaiImg) {
          $('.tc').prepend(image);
          cunzaiImg = true;
        }
        $('.tc').show()
        return
      }
      const a = document.createElement('a');
      a.href = imgUrl;
      a.download = imgUrl;
      a.click();
    });
  }
  takeScreenshot();
}
$('.baocun').click(async function () {
  $('.baocun').hide()
  $('.footer p').show()
  await creatCImg()
  $('.baocun').show()
  $('.footer p').hide()
})

$('.close-1').click(function () {
  $('.tc').hide()
})